% File konfigurasi terpusat untuk semua dokumen
% Digunakan oleh main.tex dan semua file subfiles
% File ini berisi semua package dan setting yang sama

% ============================================
% PACKAGES DASAR
% ============================================
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[bahasa]{babel}

% Package csquotes untuk biblatex (recommended)
\usepackage{csquotes}

% Font standar buku ajar Indonesia (Times New Roman atau serif)
\usepackage{times}  % Times New Roman untuk teks utama
% Alternatif: \usepackage{mathptmx} untuk Times dengan math support

% ============================================
% PACKAGES UNTUK LAYOUT DAN FORMATTING
% ============================================
\usepackage{geometry}
\usepackage{enumitem}
\usepackage{setspace}

% ============================================
% PACKAGES UNTUK HYPERLINK DAN URL
% ============================================
\usepackage[pdfencoding=auto,unicode=true,breaklinks=true,draft=false]{hyperref}
\hypersetup{
    pdfstartview={FitH},
    pdfpagelayout=SinglePage,
    colorlinks=true,
    linkcolor=blue,
    urlcolor=blue,
    citecolor=blue,
    bookmarksopen=true,
    bookmarksnumbered=true,
    pdfduplex=Simplex,
    hypertexnames=false
}
\usepackage{url}
\usepackage{xurl}

% ============================================
% PACKAGES UNTUK TABEL
% ============================================
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{longtable}

% ============================================
% PACKAGES UNTUK GRAFIK DAN GAMBAR
% ============================================
\usepackage{graphicx}
\usepackage{adjustbox}
\usepackage{float}
\usepackage{placeins}

% Konfigurasi default posisi untuk figure dan table (dinamis)
% [!htbp] = here, top, bottom, atau separate page (dengan override LaTeX parameters)
% Ini memungkinkan LaTeX untuk memilih posisi terbaik secara otomatis
\floatplacement{figure}{!htbp}
\floatplacement{table}{!htbp}

% ============================================
% PACKAGES UNTUK MATEMATIKA
% ============================================
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{textcomp}
\usepackage{textgreek}
\usepackage{silence}
\WarningFilter{latexfont}{Font shape}
\WarningFilter{latexfont}{Some font shapes}
% Menekan warning citation undefined saat kompilasi per-bab
\WarningFilter{biblatex}{Citation}
\WarningFilter{biblatex}{Patching footnotes failed}
\WarningFilter{biblatex}{Language}

% ============================================
% PACKAGES UNTUK KODE PROGRAM
% ============================================
\usepackage{listings}
\usepackage{xcolor}
\usepackage{fancyvrb}

% ============================================
% PACKAGES UNTUK DIAGRAM DAN TREE
% ============================================
\usepackage{forest}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning, calc, matrix}

% ============================================
% PACKAGES UNTUK BIBLIOGRAFI
% ============================================
% Menggunakan biblatex dengan refsegment untuk bibliografi per chapter
% refsegment=chapter: setiap chapter memiliki bibliografi sendiri (untuk kompilasi dari main.tex)
% defernumbers=true: penomoran ditunda sampai akhir untuk konsistensi
% sorting=none: tidak mengurutkan referensi (menjaga urutan citation)
% style=numeric: menggunakan style numerik (seperti plainnat)
% backend=biber: menggunakan biber sebagai backend (lebih modern dari bibtex)
% Untuk kompilasi standalone, refsection akan dibuat manual di setiap file bab
\usepackage[style=numeric,backend=biber,refsegment=chapter,defernumbers=true,sorting=none]{biblatex}

% ============================================
% PACKAGE UNTUK SUBFILES (untuk kompilasi independen chapter)
% ============================================
\usepackage{subfiles}

% ============================================
% DUKUNGAN UNICODE KHUSUS
% ============================================
\DeclareUnicodeCharacter{2192}{$\rightarrow$}  % →
\DeclareUnicodeCharacter{2190}{$\leftarrow$}  % ←
\DeclareUnicodeCharacter{2713}{$\checkmark$}   % ✓
\DeclareUnicodeCharacter{2717}{$\times$}      % ✗
\DeclareUnicodeCharacter{8320}{$_0$}           % ₀
\DeclareUnicodeCharacter{8321}{$_1$}           % ₁
\DeclareUnicodeCharacter{8322}{$_2$}           % ₂

% ============================================
% KONFIGURASI GEOMETRY
% ============================================
% Konfigurasi geometry sesuai standar buku ajar Indonesia (Kementerian Pendidikan Tinggi)
% Untuk kertas A4 (29,7 x 21 cm):
% - Margin atas: 2,5-3 cm
% - Margin kiri: 3 cm (untuk penjilidan)
% - Margin kanan: 2 cm
% - Margin bawah: 2-2,5 cm
\geometry{
    a4paper,
    top=2.5cm,
    bottom=2.5cm,
    left=3cm,
    right=2cm,
    bindingoffset=0.5cm,
    headheight=25.2pt,
    headsep=0.5cm,
    footskip=1cm
}

% ============================================
% KONFIGURASI SPACING
% ============================================
% Spacing 1.5 sesuai standar Indonesia
\onehalfspacing

% ============================================
% KONFIGURASI UNTUK MENGURANGI WARNING
% ============================================
% Mengurangi overfull hbox warnings
\sloppy
\emergencystretch=3em
\hbadness=10000
\vbadness=10000
\tolerance=10000
\pretolerance=10000
% Memungkinkan breaking URL di mana saja
\Urlmuskip=0mu plus 1mu

% ============================================
% KONFIGURASI LISTINGS UNTUK KODE
% ============================================
\lstset{
    language=C++,
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=\color{blue}\bfseries,
    commentstyle=\color{green!60!black},
    stringstyle=\color{red},
    numbers=left,
    numberstyle=\tiny,
    stepnumber=1,
    numbersep=4pt,
    frame=single,
    breaklines=true,
    breakatwhitespace=false,
    breakindent=0pt,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    showstringspaces=false,
    tabsize=2,
    extendedchars=true,
    upquote=true,
    columns=flexible,
    keepspaces=true,
    aboveskip=3pt,
    belowskip=3pt,
    lineskip=1pt
}

% ============================================
% KONFIGURASI VERBATIM UNTUK UKURAN LEBIH KECIL
% ============================================
% Redefine verbatim environment untuk menggunakan font lebih kecil
\let\oldverbatim\verbatim
\let\endoldverbatim\endverbatim
\renewenvironment{verbatim}{%
    \footnotesize
    \oldverbatim
}{%
    \endoldverbatim
}

% ============================================
% PACKAGES UNTUK BOXES DAN HIGHLIGHT OBE
% ============================================
\usepackage{tcolorbox}
\tcbuselibrary{skins,breakable}

% Box untuk konsep penting
\newtcolorbox{konsep}{
  colback=blue!5!white,
  colframe=blue!75!black,
  fonttitle=\bfseries,
  title=Konsep Penting,
  breakable
}

% Box untuk catatan
\newtcolorbox{catatan}{
  colback=yellow!5!white,
  colframe=yellow!75!black,
  fonttitle=\bfseries,
  title=Catatan,
  breakable
}

% Box untuk contoh
\newtcolorbox{contoh}{
  colback=green!5!white,
  colframe=green!75!black,
  fonttitle=\bfseries,
  title=Contoh,
  breakable
}

% ============================================================
% CUSTOM ENVIRONMENTS UNTUK OBE
% ============================================================

% --- Environment untuk Sub-CPMK ---
\newenvironment{subcpmk}{
  \vspace{0.5cm}
  \noindent\colorbox{blue!10}{\parbox{\dimexpr\textwidth-2\fboxsep}{
    \textbf{\large Sub-CPMK yang Dicakup dalam Bab Ini:}
  }}
  \vspace{0.3cm}
  \begin{itemize}[leftmargin=*, itemsep=5pt]
}{
  \end{itemize}
  \vspace{0.5cm}
}

% --- Environment untuk Aktivitas Pembelajaran ---
\newenvironment{aktivitas}{
  \vspace{0.5cm}
  \noindent\colorbox{green!10}{\parbox{\dimexpr\textwidth-2\fboxsep}{
    \textbf{\large Aktivitas Pembelajaran}
  }}
  \vspace{0.3cm}
  \begin{enumerate}[leftmargin=*, itemsep=8pt]
}{
  \end{enumerate}
  \vspace{0.5cm}
}

% --- Environment untuk Latihan ---
\newenvironment{latihan}{
  \vspace{0.5cm}
  \noindent\colorbox{orange!10}{\parbox{\dimexpr\textwidth-2\fboxsep}{
    \textbf{\large Latihan dan Refleksi}
  }}
  \vspace{0.3cm}
  \begin{enumerate}[leftmargin=*, itemsep=8pt]
}{
  \end{enumerate}
  \vspace{0.5cm}
}

% --- Environment untuk Asesmen ---
\newenvironment{asesmen}{
  \vspace{0.5cm}
  \noindent\colorbox{red!10}{\parbox{\dimexpr\textwidth-2\fboxsep}{
    \textbf{\large Asesmen (Evaluasi Kinerja)}
  }}
  \vspace{0.3cm}
}{
  \vspace{0.5cm}
}

% --- Environment untuk Checklist Kompetensi ---
\newenvironment{checklist}{
  \vspace{0.5cm}
  \noindent\colorbox{purple!10}{\parbox{\dimexpr\textwidth-2\fboxsep}{
    \textbf{\large Checklist Pencapaian Kompetensi}
  }}
  \vspace{0.3cm}
  \noindent\textit{Centang item berikut setelah Anda yakin telah menguasainya:}
  \vspace{0.2cm}
  \begin{itemize}[leftmargin=*, itemsep=5pt, label=$\square$]
}{
  \end{itemize}
  \vspace{0.5cm}
}

% --- Environment untuk Rangkuman ---
\newenvironment{rangkuman}{
  \vspace{0.5cm}
  \noindent\colorbox{gray!10}{\parbox{\dimexpr\textwidth-2\fboxsep}{
    \textbf{\large Rangkuman}
  }}
  \vspace{0.3cm}
}{
  \vspace{0.5cm}
}

% ============================================================
% CUSTOM COMMANDS UNTUK KOMPILATOR
% ============================================================

% Command untuk highlight istilah compiler
\newcommand{\compiler}[1]{\textbf{\textit{#1}}}

% Command untuk code inline
\newcommand{\code}[1]{\texttt{#1}}

% Command untuk keyword
\newcommand{\keyword}[1]{\textcolor{blue}{\texttt{\textbf{#1}}}}

% Command untuk nama tool
\newcommand{\tool}[1]{\texttt{#1}}

% Command untuk nama file
\newcommand{\filename}[1]{\texttt{#1}}

% ============================================
% KONFIGURASI KHUSUS UNTUK BOOK CLASS
% ============================================
% Conditional loading: hanya load jika documentclass adalah 'book'
\makeatletter
\@ifclassloaded{book}{%
    % Packages khusus untuk book
    \usepackage[toc]{appendix}
    \usepackage{fancyhdr}
    
    % Konfigurasi ukuran font untuk judul bab dan subjudul
    % Judul bab: 16pt, Section: 14pt (sesuai standar Kementerian Pendidikan Tinggi)
    \renewcommand{\@makechapterhead}[1]{%
      \vspace*{50\p@}%
      {\parindent \z@ \raggedright \normalfont
        \ifnum \c@secnumdepth >\m@ne
            \huge\bfseries \@chapapp\space \thechapter
            \par\nobreak
            \vskip 20\p@
        \fi
        \interlinepenalty\@M
        \fontsize{16}{20}\selectfont\bfseries #1\par\nobreak
        \vskip 40\p@
      }}
    % Konfigurasi section (14pt sesuai standar)
    \renewcommand{\section}{\@startsection {section}{1}{\z@}%
                                       {-3.5ex \@plus -1ex \@minus -.2ex}%
                                       {2.3ex \@plus.2ex}%
                                       {\normalfont\fontsize{14}{18}\selectfont\bfseries}}
    
    % Konfigurasi header dan footer
    \pagestyle{fancy}
    \fancyhf{}
    \fancyhead[LE]{\small\leftmark}
    \fancyhead[RO]{\small\rightmark}
    \fancyfoot[C]{\small\thepage}
    \renewcommand{\headrulewidth}{0.4pt}
    \renewcommand{\footrulewidth}{0pt}
}{}
\makeatother

% ============================================
% KONFIGURASI KHUSUS UNTUK ARTICLE CLASS
% ============================================
% Conditional loading: hanya load jika documentclass adalah 'article'
\makeatletter
\@ifclassloaded{article}{%
    % Untuk simulasi chapter di article
    % Definisi ini akan di-override di beberapa file standalone yang menggunakan \clearpage
    % Tapi default-nya adalah \newpage dengan \section*
    \newcommand{\chapter}[1]{%
        \newpage
        \section*{#1}
    }
    
    % Load bibliografi untuk kompilasi standalone (dari folder chapters)
    \addbibresource{../references.bib}
}{}
\makeatother
