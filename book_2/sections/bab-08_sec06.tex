\section{Contoh Lengkap: Calculator dengan Bison}

Mari kita buat contoh lengkap parser untuk calculator sederhana menggunakan Flex dan Bison.

\subsection{File Lexer (calc.l)}

\begin{lstlisting}[language=C, caption={File lexer untuk calculator}]
%{
#include "calc.tab.h"  // Header yang dihasilkan Bison
#include <stdlib.h>
%}

%%
[0-9]+          { yylval.intval = atoi(yytext); return NUMBER; }
[0-9]+\.[0-9]+  { yylval.dval = atof(yytext); return FLOAT; }
[ \t\n]         { /* skip whitespace */ }
"+"             { return PLUS; }
"-"             { return MINUS; }
"*"             { return MULTIPLY; }
"/"             { return DIVIDE; }
"("             { return LPAREN; }
")"             { return RPAREN; }
.               { return yytext[0]; }
%%

int yywrap() { return 1; }
\end{lstlisting}

\subsection{File Parser (calc.y)}

\begin{lstlisting}[language=C, caption={File parser untuk calculator}]
%{
#include <stdio.h>
#include <stdlib.h>

extern int yylex();
extern int yyparse();
void yyerror(const char *s);
%}

%union {
    int intval;
    double dval;
}

%token <intval> NUMBER
%token <dval> FLOAT
%token PLUS MINUS MULTIPLY DIVIDE LPAREN RPAREN

%left PLUS MINUS
%left MULTIPLY DIVIDE

%type <dval> expr

%%
input:
    /* empty */
  | input expr '\n' { printf("Result = %g\n", $2); }
  ;

expr:
    NUMBER        { $$ = (double)$1; }
  | FLOAT         { $$ = $1; }
  | expr '+' expr { $$ = $1 + $3; }
  | expr '-' expr { $$ = $1 - $3; }
  | expr '*' expr { $$ = $1 * $3; }
  | expr '/' expr {
        if ($3 == 0.0) {
          yyerror("Division by zero");
          $$ = 0.0;
        } else {
          $$ = $1 / $3;
        }
      }
  | '(' expr ')'  { $$ = $2; }
  ;

%%

void yyerror(const char *s) {
    fprintf(stderr, "Error: %s\n", s);
}

int main() {
    printf("Calculator - Enter expressions (Ctrl+D to exit)\n");
    yyparse();
    return 0;
}
\end{lstlisting}

\subsection{Kompilasi dan Eksekusi}

Untuk mengompilasi program:

\begin{verbatim}
flex calc.l          # Generate lexer
bison -d calc.y      # Generate parser (d flag untuk header)
gcc lex.yy.c calc.tab.c -o calc -lfl
./calc
\end{verbatim}